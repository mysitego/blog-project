<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أداء الموقع | لوحة التحكم</title>
    <meta name="description" content="مراقبة أداء الموقع في لوحة تحكم المدونة">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/admin-images.css">
    
    <!-- Favicon -->
    <link rel="icon" href="../images/logo.png" type="image/jpeg">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body class="admin-dashboard">
    <!-- الشريط الجانبي -->
    <aside class="admin-sidebar" id="adminSidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <img src="../images/logo.png" alt="شعار المدونة" class="sidebar-logo-img">
                <div class="sidebar-logo-text">
                    <h3>مدونة المعرفة</h3>
                </div>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <nav class="sidebar-nav">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>لوحة التحكم</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="posts.html" class="nav-link">
                        <i class="fas fa-edit"></i>
                        <span>المقالات</span>
                        <span class="nav-badge">25</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="categories.html" class="nav-link">
                        <i class="fas fa-tags"></i>
                        <span>الفئات</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="comments.html" class="nav-link">
                        <i class="fas fa-comments"></i>
                        <span>التعليقات</span>
                        <span class="nav-badge new">12</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="users.html" class="nav-link">
                        <i class="fas fa-users"></i>
                        <span>المستخدمون</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="#" class="nav-link nav-dropdown-toggle">
                        <i class="fas fa-chart-line"></i>
                        <span>التقارير</span>
                        <i class="fas fa-chevron-down nav-arrow"></i>
                    </a>
                    <ul class="nav-dropdown show">
                        <li><a href="analytics.html">الإحصائيات</a></li>
                        <li><a href="reports.html">التقارير</a></li>
                        <li class="active"><a href="performance.html">الأداء</a></li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a href="media.html" class="nav-link">
                        <i class="fas fa-images"></i>
                        <span>الوسائط</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <i class="fas fa-cog"></i>
                        <span>الإعدادات</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <img src="../images/avatar-1.png" alt="صورة المستخدم" class="user-avatar">
                <div class="user-details">
                    <span class="user-name">المدير العام</span>
                    <span class="user-role">مدير</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- المحتوى الرئيسي -->
    <main class="admin-main">
        <header class="admin-header">
            <div class="header-left">
                <button class="mobile-sidebar-toggle" id="mobileSidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="page-title">
                    <h1>أداء الموقع</h1>
                    <span class="page-subtitle">مراقبة وتحسين أداء الموقع</span>
                </div>
            </div>

            <div class="header-actions">
                <button class="btn btn-outline-secondary" id="refreshPerformance">
                    <i class="fas fa-sync-alt"></i>
                    تحديث
                </button>
            </div>
        </header>

        <div class="admin-content">
            <!-- بطاقات الأداء -->
            <div class="row g-4 mb-4">
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="stat-icon bg-primary bg-opacity-10 text-primary">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3>1.2s</h3>
                            <p>وقت التحميل الكلي</p>
                            <span class="text-success">
                                <i class="fas fa-arrow-down"></i> 12.5%
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="stat-icon bg-success bg-opacity-10 text-success">
                            <i class="fas fa-server"></i>
                        </div>
                        <div class="stat-info">
                            <h3>320ms</h3>
                            <p>وقت استجابة الخادم</p>
                            <span class="text-success">
                                <i class="fas fa-arrow-down"></i> 5.2%
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="stat-icon bg-warning bg-opacity-10 text-warning">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="stat-info">
                            <h3>45</h3>
                            <p>استعلامات قاعدة البيانات</p>
                            <span class="text-danger">
                                <i class="fas fa-arrow-up"></i> 3.1%
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="stat-icon bg-info bg-opacity-10 text-info">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3>1.8MB</h3>
                            <p>حجم الصفحة</p>
                            <span class="text-success">
                                <i class="fas fa-arrow-down"></i> 8.4%
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- الرسوم البيانية -->
            <div class="row g-4 mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">أداء تحميل الصفحة</h5>
                            <div class="btn-group btn-group-sm">
                                <button type="button" class="btn btn-outline-secondary active">24 ساعة</button>
                                <button type="button" class="btn btn-outline-secondary">أسبوع</button>
                                <button type="button" class="btn btn-outline-secondary">شهر</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="pageLoadChart" style="height: 300px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="card-title mb-0">أبطأ الصفحات تحميلاً</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>الصفحة</th>
                                            <th>وقت التحميل</th>
                                            <th>الحجم</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>الصفحة الرئيسية</td>
                                            <td>1.2s</td>
                                            <td>1.8MB</td>
                                        </tr>
                                        <tr>
                                            <td>مقال: دليل تطوير الويب</td>
                                            <td>1.8s</td>
                                            <td>2.1MB</td>
                                        </tr>
                                        <tr>
                                            <td>المدونة</td>
                                            <td>1.1s</td>
                                            <td>1.5MB</td>
                                        </tr>
                                        <tr>
                                            <td>من نحن</td>
                                            <td>0.9s</td>
                                            <td>1.2MB</td>
                                        </tr>
                                        <tr>
                                            <td>اتصل بنا</td>
                                            <td>0.8s</td>
                                            <td>1.1MB</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="card-title mb-0">استهلاك الموارد</h5>
                        </div>
                        <div class="card-body">
                            <div id="resourceUsageChart" style="height: 300px;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- اقتراحات التحسين -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">اقتراحات لتحسين الأداء</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning">
                                <div class="d-flex">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h5 class="alert-heading">تحذير!</h5>
                                        <p class="mb-0">تم اكتشاف بعض المشاكل التي قد تؤثر على أداء موقعك. نوصي بمعالجتها في أقرب وقت ممكن.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="list-group list-group-flush">
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">تحسين الصور</h6>
                                            <p class="mb-0 text-muted">يمكنك تقليل حجم الصور بنسبة 45% تقريبًا دون التأثير على الجودة.</p>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary">عرض التفاصيل</button>
                                    </div>
                                </div>
                                
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">تمكين التخزين المؤقت</h6>
                                            <p class="mb-0 text-muted">تفعيل التخزين المؤقت للمتصفح يمكن أن يحسن أوقات التحميل بنسبة تصل إلى 30%.</p>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary">تفعيل الآن</button>
                                    </div>
                                </div>
                                
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">تقليل استعلامات قاعدة البيانات</h6>
                                            <p class="mb-0 text-muted">تم اكتشاف 45 استعلام قاعدة بيانات. يمكن تحسين هذا الرقم.</p>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary">عرض التفاصيل</button>
                                    </div>
                                </div>
                                
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">دمج ملفات CSS و JavaScript</h6>
                                            <p class="mb-0 text-muted">دمج الملفات يمكن أن يقلل من عدد طلبات HTTP.</p>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary">دمج الملفات</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript Files -->
    <script src="../js/main.js"></script>
    <script src="../js/admin-dashboard.js"></script>
    <script>
        // تحميل الرسوم البيانية عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // رسم بياني لأداء تحميل الصفحة
            var pageLoadOptions = {
                series: [{
                    name: 'وقت التحميل (بالثواني)',
                    data: [1.8, 1.5, 2.1, 1.9, 1.7, 1.4, 1.2, 1.5, 1.8, 1.6, 1.3, 1.1, 1.4, 1.7, 1.9, 1.6, 1.3, 1.5, 1.8, 2.0, 1.7, 1.4, 1.2, 1.0]
                }],
                chart: {
                    height: 350,
                    type: 'area',
                    fontFamily: 'Tajawal, sans-serif',
                    toolbar: {
                        show: false
                    },
                    zoom: {
                        enabled: false
                    }
                },
                colors: ['#4e73df'],
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth',
                    width: 2
                },
                xaxis: {
                    categories: Array.from({length: 24}, (_, i) => i + ':00'),
                    labels: {
                        style: {
                            fontSize: '12px'
                        }
                    },
                    axisBorder: {
                        show: false
                    },
                    axisTicks: {
                        show: false
                    }
                },
                yaxis: {
                    labels: {
                        formatter: function (value) {
                            return value + 's';
                        },
                        style: {
                            fontSize: '12px'
                        }
                    }
                },
                tooltip: {
                    y: {
                        formatter: function (value) {
                            return value + ' ثانية';
                        }
                    },
                    rtl: true
                },
                grid: {
                    borderColor: '#f1f1f1',
                    strokeDashArray: 3
                },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.3,
                        stops: [0, 90, 100]
                    }
                }
            };

            var pageLoadChart = new ApexCharts(document.querySelector("#pageLoadChart"), pageLoadOptions);
            pageLoadChart.render();

            // رسم بياني لاستهلاك الموارد
            var resourceUsageOptions = {
                series: [{
                    name: 'الذاكرة',
                    type: 'column',
                    data: [45, 52, 38, 24, 33, 26, 21, 20, 6, 8, 15, 10]
                }, {
                    name: 'وحدة المعالجة المركزية',
                    type: 'line',
                    data: [30, 25, 36, 30, 45, 35, 64, 52, 59, 36, 39, 25]
                }],
                chart: {
                    height: 350,
                    type: 'line',
                    fontFamily: 'Tajawal, sans-serif',
                    toolbar: {
                        show: false
                    },
                    zoom: {
                        enabled: false
                    }
                },
                colors: ['#4e73df', '#1cc88a'],
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    width: [1, 3],
                    curve: 'smooth'
                },
                plotOptions: {
                    bar: {
                        columnWidth: '50%',
                        borderRadius: 4
                    }
                },
                xaxis: {
                    categories: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'],
                    labels: {
                        style: {
                            fontSize: '12px'
                        }
                    },
                    axisBorder: {
                        show: false
                    },
                    axisTicks: {
                        show: false
                    }
                },
                yaxis: [{
                    title: {
                        text: 'الذاكرة (MB)',
                        style: {
                            fontSize: '12px',
                            color: '#4e73df'
                        }
                    },
                    labels: {
                        style: {
                            colors: ['#4e73df'],
                            fontSize: '12px'
                        }
                    }
                }, {
                    opposite: true,
                    title: {
                        text: 'وحدة المعالجة المركزية (%)',
                        style: {
                            fontSize: '12px',
                            color: '#1cc88a'
                        }
                    },
                    labels: {
                        style: {
                            colors: ['#1cc88a'],
                            fontSize: '12px'
                        },
                        formatter: function(value) {
                            return value + '%';
                        }
                    },
                    min: 0,
                    max: 100
                }],
                tooltip: {
                    rtl: true,
                    y: [{
                        formatter: function (value) {
                            return value + ' MB';
                        }
                    }, {
                        formatter: function (value) {
                            return value + '%';
                        }
                    }]
                },
                grid: {
                    borderColor: '#f1f1f1',
                    strokeDashArray: 3
                },
                legend: {
                    position: 'top',
                    horizontalAlign: 'left',
                    offsetY: -10
                }
            };

            var resourceUsageChart = new ApexCharts(document.querySelector("#resourceUsageChart"), resourceUsageOptions);
            resourceUsageChart.render();

            // تحديث البيانات عند النقر على زر التحديث
            document.getElementById('refreshPerformance').addEventListener('click', function() {
                // إظهار مؤشر التحميل
                this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> جاري التحديث...';
                this.disabled = true;
                
                // محاكاة طلب الخادم
                setTimeout(() => {
                    // تحديث الرسوم البيانية
                    pageLoadChart.updateSeries([{
                        data: Array.from({length: 24}, () => Math.random() * 2 + 0.5)
                    }]);
                    
                    resourceUsageChart.updateSeries([{
                        data: Array.from({length: 12}, () => Math.floor(Math.random() * 60) + 10)
                    }, {
                        data: Array.from({length: 12}, () => Math.floor(Math.random() * 80) + 10)
                    }]);
                    
                    // إعادة تعيين الزر
                    this.innerHTML = '<i class="fas fa-sync-alt"></i> تحديث';
                    this.disabled = false;
                    
                    // إظهار رسالة نجاح
                    const toast = document.createElement('div');
                    toast.className = 'toast align-items-center text-white bg-success border-0 position-fixed bottom-0 end-0 m-3';
                    toast.setAttribute('role', 'alert');
                    toast.setAttribute('aria-live', 'assertive');
                    toast.setAttribute('aria-atomic', 'true');
                    toast.innerHTML = `
                        <div class="d-flex">
                            <div class="toast-body">
                                تم تحديث بيانات الأداء بنجاح
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                    `;
                    document.body.appendChild(toast);
                    
                    const toastBootstrap = new bootstrap.Toast(toast);
                    toastBootstrap.show();
                    
                    // إزالة الرسالة بعد 3 ثوانٍ
                    setTimeout(() => {
                        toastBootstrap.hide();
                        setTimeout(() => {
                            document.body.removeChild(toast);
                        }, 150);
                    }, 3000);
                }, 1000);
            });
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
